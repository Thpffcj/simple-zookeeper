# 基于Zookeeper解决常见分布式问题

- ZooKeeper是一个分布式的，开放源码的分布式应用程序协调服务
- ZooKeeper的目标就是封装好复杂易出错的关键服务，将简单易用的接口和性能高效、功能稳定的系统提供给用户
- ZooKeeper包含一个简单的原语集，提供Java和C的接口

## 1. 简介

学习Zookeeper也有一段时间了，我想从实际的分布式应用场景出发，来学习如何使用Zookeeper去解决一些常见的分布式问题，对常见应用场景主要提供Java原生API和Curator两种实现方式

### 1. Zookeeper

Zookeeper作为一个分布式服务框架，主要用来解决分布式数据一致性问题，它提供了简单的分布式原语，并且对多种编程语言提供了API，我们重点使用Zookeeper的Java客户端API实现常用应用场景。

### 2. Curator

为了更好的实现Java操作Zookeeper服务器，后来出现了Curator框架，非常的强大，目前已经是Apache的顶级项目，里面提供了更多丰富的操作，例如session超时重连、主从选举、分布式计数器、分布式锁等等适用于各种复杂的zookeeper场景的API封装。

## 2. 常用场景

### 1. 数据发布/订阅

### 2. 负载均衡

### 3. 命名服务

### 4. 分布式协调/通知

### 5. 集群管理

### 6. Master选举

- 在分布式计算中，Master选举是很重要的一个功能。分布式最核心的特性就是能够将具有独立计算能力的系统单元部署在不同的机器上，构成一个完整的分布式系统。
- 在分布式系统中，Master往往用来协调集群中其他系统单元，具有对分布式系统状态变更的决定权。
- 利用ZooKeeper的强一致性，能够很好地保证在分布式高并发情况下节点的创建一定能够保证全局唯一性，即ZooKeeper将会保证客户端无法重复创建一个已经存在的数据节点。也就是说，如果同时有多个客户端请求创建同一个节点，那么最终一定只有一个客户端请求能够创建成功。利用这个特性，就能很容易地在分布式环境中进行Master选举了。
- 客户端往ZooKeeper上创建一个临时节点，在这个过程中，只有一个客户端能够成功创建这个节点，那么这个客户端所在的机器就成为了Master。同时，其他没有在ZooKeeper上成功创建节点的客户端，都会在节点上注册一个子节点变更的Watcher，用于监控当前的Master机器是否存活，一旦发现当前的Master挂了，那么其余的客户端将会重新进行Master选举。
- 我们可以看到，如果仅仅只是想实现Master选举的话，那么其实只需要有一个能够保证数据唯一性的组件即可，例如关系型数据库的主键模型就是非常不错的选择。但是，如果希望能够快速地进行集群Master动态选举，那么基于ZooKeeper来实现是一个不错的新思路。

### 7. 分布式锁



### 8. 分布式队列